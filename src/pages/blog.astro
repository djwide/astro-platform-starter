---
import { getStore } from '@netlify/blobs';
import Layout from '../layouts/Layout.astro';
import SubpageNav from '../components/SubpageNav.astro';

export const prerender = false;

const blobStore = getStore({ name: 'blog-posts', consistency: 'strong' });
const list = await blobStore.list();
const posts = await Promise.all(
  list.blobs.map(async ({ key }) => {
    const post = await blobStore.getJSON(key);
    return { ...post, key };
  })
);
const sortedPosts = posts
  .filter((post) => post?.title)
  .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());
---

<Layout title="Blog">
  <div class="max-w-3xl mx-auto">
    <header class="mb-8 space-y-4">
      <SubpageNav />
      <h1 class="mb-2">Blog</h1>
    </header>

    <div class="rounded border border-blue-200 bg-blue-50 px-4 py-3 text-blue-900">
      <p class="font-semibold">Looking for my latest writing?</p>
      <p>
        Visit the SenTeGuard blog at
        <a
          href="https://senteguard.com/blog/"
          class="underline"
          target="_blank"
          rel="noreferrer"
        >
          senteguard.com/blog
        </a>
        for the newest posts and updates.
      </p>
    </div>
  </div>
</Layout>
